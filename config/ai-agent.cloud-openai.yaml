# Cloud-only OpenAI pipeline configuration
# Copy to config/ai-agent.yaml to use OpenAI for STT, LLM, and TTS.

default_provider: "openai_realtime"  # Monolithic fallback; pipelines recommended

pipelines:
  cloud_only_openai:
    stt: openai_stt
    llm: openai_llm
    tts: openai_tts
    options:
      stt:
        base_url: "wss://api.openai.com/v1/realtime"
      llm:
        base_url: "https://api.openai.com/v1"
        chat_model: "gpt-4o-mini"
        timeout_sec: 15.0
      tts:
        base_url: "https://api.openai.com/v1/audio/speech"
        format:
          encoding: mulaw
          sample_rate: 8000

active_pipeline: cloud_only_openai

audio_transport: "audiosocket"
downstream_mode: "stream"

audiosocket:
  host: "0.0.0.0"
  port: 8090
  format: "ulaw"

# Telephony-tuned barge-in and VAD
barge_in:
  enabled: true
  initial_protection_ms: 350    # Drop inbound during agent intro; 200–600 ms. Higher = less echo, more delay.
  min_ms: 300                   # Sustained speech required to trigger; 250–600 ms. Lower = more sensitive.
  energy_threshold: 1800        # RMS threshold for speech detection; 1000–3000. Raise on noisy lines.
  cooldown_ms: 800              # Ignore retriggers for this period after one fires; 500–1500 ms.
  post_tts_end_protection_ms: 250  # Guard after TTS ends to avoid clipping callers; 250–500 ms.

# VAD: add a `vad:` block if you need utterance segmentation control; see docs/Configuration-Reference.md

vad:
  webrtc_aggressiveness: 1
  webrtc_start_frames: 2
  webrtc_end_silence_frames: 25
  min_utterance_duration_ms: 2000
  max_utterance_duration_ms: 10000
  utterance_padding_ms: 200
  fallback_enabled: true
  fallback_interval_ms: 2000
  fallback_buffer_size: 64000

providers:
  openai:
    enabled: true
    api_key: "${OPENAI_API_KEY}"

# Canonical LLM defaults (used by providers/pipelines unless overridden)
llm:
  initial_greeting: "Hello, how can I help you today?"
  prompt: "You are a concise and helpful voice assistant. Keep replies under 20 words unless asked for detail."
  model: "gpt-4o"
